<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Heroku | Mátyás Budavári</title><meta name=keywords content="site-description,hosting,git,javascript"><meta name=description content="My favourite place to deploy simple hobby and experimental web applications
is heroku.
It has a free plan, and it&rsquo;s pretty easy to
get started."><meta name=author content="Mátyás Budavári"><meta name=theme-color content="#317EFB"><link rel=canonical href=https://budavariam.github.io/posts/2020/06/14/heroku/><meta name=google-site-verification content="ocrG4G5ZSn2awC0mgHAsgk2qlhd3IAXCACgWNrqJcwY"><link href=/assets/css/stylesheet.min.8992a6674f694d99a84bca35962c31e8f7c81352f54d3e95def071e7d30507dd.css integrity="sha256-iZKmZ09pTZmoS8o1liwx6PfIE1L1TT6V3vBx59MFB90=" rel="preload stylesheet" as=style><script src=https://kit.fontawesome.com/68da183384.js crossorigin=anonymous></script>
<link rel=icon href=https://budavariam.github.io/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://budavariam.github.io/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://budavariam.github.io/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://budavariam.github.io/favicon/apple-icon-180x180.png><link rel=mask-icon href=https://budavariam.github.io/favicon/apple-icon-180x180.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.97.2"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-115499513-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Heroku"><meta property="og:description" content="My favourite place to deploy simple hobby and experimental web applications
is heroku.
It has a free plan, and it&rsquo;s pretty easy to
get started."><meta property="og:type" content="article"><meta property="og:url" content="https://budavariam.github.io/posts/2020/06/14/heroku/"><meta property="og:image" content="https://budavariam.github.io/logo.png"><meta property="article:published_time" content="2020-06-14T00:00:00+00:00"><meta property="article:modified_time" content="2020-06-14T00:00:00+00:00"><meta property="og:site_name" content="Mátyás Budavári"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://budavariam.github.io/logo.png"><meta name=twitter:title content="Heroku"><meta name=twitter:description content="My favourite place to deploy simple hobby and experimental web applications
is heroku.
It has a free plan, and it&rsquo;s pretty easy to
get started."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://budavariam.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Heroku","item":"https://budavariam.github.io/posts/2020/06/14/heroku/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Heroku","name":"Heroku","description":"My favourite place to deploy simple hobby and experimental web applications is heroku. It has a free plan, and it\u0026amp;rsquo;s pretty easy to get started.\n","keywords":["site-description","hosting","git","javascript"],"articleBody":"My favourite place to deploy simple hobby and experimental web applications is heroku. It has a free plan, and it’s pretty easy to get started.\nHeroku can detect the type of your application, if it is in the root of your repository, but if you need some custom options, you can define a Procfile.\nIn the free plan as of today you can have 1000 hour of free hosting on spare instances. When your application is not used, it goes to sleep mode, and stays awake for a short period of time, or until it’s used. It means that the first reach of your application might take a bit longer, and if you don’t persist your application state it can be lost.\nGet started I usually use the heroku CLI to manage my applications.\n register in heroku, create a git repo for the project, navigate to it heroku login - opens the browser and authenticates for the CLI session heroku create project-name - creates a new project, and sets a new remote called heroku for the it up for the current git repository magic happens here (create the app) git push heroku master - start the deployment heroku logs -t - shows the logs of the current heroku app  Serve create-react-app application Sometimes I just write a simpe react web application without any backend, that I just want to host somewhere for a quick demonstration.\nI haven’t found a description how to host create-react-app for this simple use case in the docs.\nThe simplest way is to put the app in the root of the repository. If heroku finds package.json in the root, it assumes that the project is a node webapp. At deployment it will install both dependencies and devDependencies, build the application with npm run build, remove devDependencies, then start the application with npm start.\nAfter create-react-app prod build, it shows a way to serve the application with serve. I added it as the start script in package.json, and build the app with react-scripts build.\nFor local development I kept react-scripts start as npm run cra-start.\nSome gotchas  Heroku needs a README.md in the root, otherwise it won’t deploy. In order to install the proper dependencies, package-lock.json or yarn.lock file must be pushed to the repo. The engines property can set the necessary npm and node versions. The port that the app needs to listen to is set in $PORT environment variable.  Sample package.json {  \"name\": \"create-react-app\",  \"version\": \"0.1.0\",  \"dependencies\": {  \"react\": \"^16.13.1\",  \"react-dom\": \"^16.13.1\",  \"react-scripts\": \"3.4.1\",  \"serve\": \"^11.3.1\"  },  \"engines\": {  \"npm\": \"6.11.3\",  \"node\": \"10.17.0\"  },  \"scripts\": {  \"start\": \"serve -s build\",  \"cra-start\": \"react-scripts start\",  \"build\": \"react-scripts build\",  },  \"eslintConfig\": {  \"extends\": \"react-app\"  },  \"browserslist\": {  \"production\": [  \"0.2%\",  \"not dead\",  \"not op_mini all\"  ],  \"development\": [  \"last 1 chrome version\",  \"last 1 firefox version\",  \"last 1 safari version\"  ]  } } Serve untracked non-generated files I had a quick and small project where I couldn’t generate the static pages with a script, but I did not want to host the generated files in the repository.\nI used a script to collect the data on every deploy, and push it to heroku. I wanted it to be simple, and reproducible in a new machine, without any manual steps.\nDeploy script I put the necessary files (package.json, package-lock.json, README.md) for heroku root into heroku-deploy folder.\nFor the sake of the example I collected the static files into untracked-files/export.\n#!/bin/bash  echo \"- Clean dist folder\" # Make sure that dist-folder does not exist rm -rf ./dist-folder echo \"- Create dist branch\" git checkout --orphan dist git reset --hard git clean -fd -e untracked-files/export git commit --allow-empty -m \"Create Empty Dist Branch\" git checkout master echo \"- Add files and push new version\" git worktree add -f dist-folder dist cp -r ./untracked-files/export/* dist-folder/ cp -r ./heroku-deploy/* dist-folder/ cd dist-folder || exit 1 git add . git commit -m 'Deploy to Heroku' git push --force heroku dist:master # force push is needed, because a # new local branch is created on every deploy. cd .. echo \"- Cleanup\" git worktree remove dist-folder git branch -D dist echo \"- Done\" Git commands to create a new empty parentless branch git checkout --orphan dist git reset --hard git clean -fd -e untracked-files/export git commit --allow-empty -m \"Create Empty Dist Branch\" git checkout master In order to create a new branch that does not have anything inside git checkout --orphan dist is a good start, it creates a new orphaned branch called dist.\nAfter this script runs, we are taken to this new branch, and every file in the work tree is in staged state.\nSome say that rm -rf . is a good next step, but for me it seems a bit dangerous.\nI sticked with git reset --hard; git clean -fd -e untracked-files/export. It unstages all the files, remove the modified files, then clean all untracked files, except the ones in the excluded (-e) directories.\nTo create a branch I added a new empty commit, and headed back to the main branch.\nGit worktree Git worktree is a way to manage multiple branches in the same repository.\nTo put it simple, it creates a folder, and when you step into that folder, git acts like you’ve checked out that branch.\ngit worktree add -f dist-folder dist cp -r anything/* dist-folder cd dist-folder # now git thinks we've checked out `dist` git add . git commit -m 'Deploy to Heroku' git push --force heroku dist:master cd .. # back in master git worktree remove dist-folder For my usecase it’s perfect, I have an empty dist branch at this point,\n I check it out into a folder called dist-folder copy the necessary files step into the worktree, so it seems like I’ve checked out dist Stage the files, commit and deploy. step out, so git thinks I’m in master, and I can safely remove dist-folder.  Since I create a new branch on every deploy, I overwrite the contents of master branch in heroku remote. Since pushes to that branch is only to trigger deployment, I never check it out, I don’t yet see a problem with this approach.\nDisclaimer I was not asked to create this post, and did not get anything for it, I just wanted to share how simple it is to use and some of my experience with it.\n","wordCount":"1058","inLanguage":"en","datePublished":"2020-06-14T00:00:00Z","dateModified":"2020-06-14T00:00:00Z","author":{"@type":"Person","name":"Mátyás Budavári"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://budavariam.github.io/posts/2020/06/14/heroku/"},"publisher":{"@type":"Organization","name":"Mátyás Budavári","logo":{"@type":"ImageObject","url":"https://budavariam.github.io/favicon/favicon.ico"}}}</script><script src=https://cdn.lr-ingest.io/LogRocket.min.js crossorigin=anonymous></script>
<script>window.LogRocket&&window.LogRocket.init("0igxfm/budavariam-blog"),window.LogRocket.getSessionURL(function(e){ga("send",{hitType:"event",eventCategory:"LogRocket",eventAction:e})})</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://budavariam.github.io/ title="Mátyás Budavári (Alt + H)" class=site-avatar><img src=/avatar.png alt=logo aria-label=logo height=70 width=70></a><div class=site-info><h1 class=site-name><a href=https://budavariam.github.io/ accesskey=h title="Mátyás Budavári (Alt + H)">Mátyás Budavári</a></h1><p class=site-description>Developer from Szeged</p></div></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://budavariam.github.io/about/ title=About><span>About</span></a></li><li><a href=https://budavariam.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://budavariam.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://budavariam.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://budavariam.github.io/projects/ title=Projects><span>Projects</span></a></li><li><span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Heroku</h1><div class=post-meta>June 14, 2020&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Mátyás Budavári
|&nbsp;<a class=edit-post href=https://github.com/budavariam/budavariam.github.io/blob/main/content/posts/2020-06-14-heroku.md rel="noopener noreferrer" target=_blank>Make it better</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#get-started aria-label="Get started">Get started</a></li><li><a href=#serve-create-react-app-application aria-label="Serve create-react-app application">Serve create-react-app application</a><ul><li><a href=#some-gotchas aria-label="Some gotchas">Some gotchas</a></li><li><a href=#sample-packagejson aria-label="Sample package.json">Sample package.json</a></li></ul></li><li><a href=#serve-untracked-non-generated-files aria-label="Serve untracked non-generated files">Serve untracked non-generated files</a><ul><li><a href=#deploy-script aria-label="Deploy script">Deploy script</a></li><li><a href=#git-commands-to-create-a-new-empty-parentless-branch aria-label="Git commands to create a new empty parentless branch">Git commands to create a new empty parentless branch</a></li><li><a href=#git-worktree aria-label="Git worktree">Git worktree</a></li></ul></li><li><a href=#disclaimer aria-label=Disclaimer>Disclaimer</a></li></ul></div></details></div><div class=post-content><p>My favourite place to deploy simple hobby and experimental web applications
is <a href=https://www.heroku.com>heroku</a>.
It has a free plan, and it&rsquo;s pretty easy to
<a href=https://devcenter.heroku.com/categories/language-support>get started</a>.</p><p>Heroku can detect the type of your application, if it is in the root of your repository,
but if you need some custom options, you can define a
<a href=https://devcenter.heroku.com/articles/procfile>Procfile</a>.</p><p>In the free plan as of today you can have 1000 hour of free hosting on spare instances.
When your application is not used, it goes to sleep mode,
and stays awake for a short period of time, or until it&rsquo;s used.
It means that the first reach of your application might take a bit longer,
and if you don&rsquo;t persist your application state it can be lost.</p><h2 id=get-started>Get started<a hidden class=anchor aria-hidden=true href=#get-started>#</a></h2><p>I usually use the <a href=https://devcenter.heroku.com/articles/heroku-cli>heroku CLI</a>
to manage my applications.</p><ol><li>register in heroku, create a git repo for the project, navigate to it</li><li><code>heroku login</code> - opens the browser and authenticates for the CLI session</li><li><code>heroku create project-name</code> - creates a new project, and sets a new remote called <code>heroku</code> for the it up for the current git repository</li><li>magic happens here (create the app)</li><li><code>git push heroku master</code> - start the deployment</li><li><code>heroku logs -t</code> - shows the logs of the current heroku app</li></ol><h2 id=serve-create-react-app-application>Serve create-react-app application<a hidden class=anchor aria-hidden=true href=#serve-create-react-app-application>#</a></h2><p>Sometimes I just write a simpe react web application without any backend,
that I just want to host somewhere for a quick demonstration.</p><p>I haven&rsquo;t found a description how to host
<a href=https://create-react-app.dev/docs/getting-started/>create-react-app</a> for this simple use case in the docs.</p><p>The simplest way is to put the app in the root of the repository.
If heroku finds <code>package.json</code> in the root, it assumes that the project is a node webapp.
At deployment it will install both <code>dependencies</code> and <code>devDependencies</code>,
build the application with <code>npm run build</code>, remove <code>devDependencies</code>,
then start the application with <code>npm start</code>.</p><p>After <code>create-react-app</code> prod build, it shows a way to serve the
application with <a href=https://www.npmjs.com/package/serve>serve</a>.
I added it as the <code>start</code> script in <code>package.json</code>, and build the app with <code>react-scripts build</code>.</p><p>For local development I kept <code>react-scripts start</code> as <code>npm run cra-start</code>.</p><h3 id=some-gotchas>Some gotchas<a hidden class=anchor aria-hidden=true href=#some-gotchas>#</a></h3><ul><li>Heroku needs a <code>README.md</code> in the root, otherwise it won&rsquo;t deploy.</li><li>In order to install the proper dependencies, <code>package-lock.json</code> or <code>yarn.lock</code> file must be pushed to the repo.</li><li>The <code>engines</code> property can set the necessary <code>npm</code> and <code>node</code> versions.</li><li>The port that the app needs to listen to is set in <code>$PORT</code> environment variable.</li></ul><h3 id=sample-packagejson>Sample package.json<a hidden class=anchor aria-hidden=true href=#sample-packagejson>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;create-react-app&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;0.1.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;dependencies&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;react&#34;</span>: <span style=color:#e6db74>&#34;^16.13.1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;react-dom&#34;</span>: <span style=color:#e6db74>&#34;^16.13.1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;react-scripts&#34;</span>: <span style=color:#e6db74>&#34;3.4.1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;serve&#34;</span>: <span style=color:#e6db74>&#34;^11.3.1&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;engines&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;npm&#34;</span>: <span style=color:#e6db74>&#34;6.11.3&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;node&#34;</span>: <span style=color:#e6db74>&#34;10.17.0&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;scripts&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;start&#34;</span>: <span style=color:#e6db74>&#34;serve -s build&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;cra-start&#34;</span>: <span style=color:#e6db74>&#34;react-scripts start&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;build&#34;</span>: <span style=color:#e6db74>&#34;react-scripts build&#34;</span>,
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;eslintConfig&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;extends&#34;</span>: <span style=color:#e6db74>&#34;react-app&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;browserslist&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;production&#34;</span>: [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;&gt;0.2%&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;not dead&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;not op_mini all&#34;</span>
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;development&#34;</span>: [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;last 1 chrome version&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;last 1 firefox version&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;last 1 safari version&#34;</span>
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=serve-untracked-non-generated-files>Serve untracked non-generated files<a hidden class=anchor aria-hidden=true href=#serve-untracked-non-generated-files>#</a></h2><p>I had a quick and small project where I couldn&rsquo;t generate the static pages
with a script, but I did not want to host the generated files in the repository.</p><p>I used a script to collect the data on every deploy, and push it to heroku.
I wanted it to be simple, and reproducible in a new machine, without any manual steps.</p><h3 id=deploy-script>Deploy script<a hidden class=anchor aria-hidden=true href=#deploy-script>#</a></h3><p>I put the necessary files (<code>package.json</code>, <code>package-lock.json</code>, <code>README.md</code>)
for heroku root into <code>heroku-deploy</code> folder.</p><p>For the sake of the example I collected the static files into <code>untracked-files/export</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;- Clean dist folder&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Make sure that dist-folder does not exist</span>
</span></span><span style=display:flex><span>rm -rf ./dist-folder
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;- Create dist branch&#34;</span>
</span></span><span style=display:flex><span>git checkout --orphan dist
</span></span><span style=display:flex><span>git reset --hard
</span></span><span style=display:flex><span>git clean -fd -e untracked-files/export
</span></span><span style=display:flex><span>git commit --allow-empty -m <span style=color:#e6db74>&#34;Create Empty Dist Branch&#34;</span>
</span></span><span style=display:flex><span>git checkout master
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;- Add files and push new version&#34;</span>
</span></span><span style=display:flex><span>git worktree add -f dist-folder dist
</span></span><span style=display:flex><span>cp -r ./untracked-files/export/* dist-folder/
</span></span><span style=display:flex><span>cp -r ./heroku-deploy/* dist-folder/
</span></span><span style=display:flex><span>cd dist-folder <span style=color:#f92672>||</span> exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>git add .
</span></span><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#39;Deploy to Heroku&#39;</span>
</span></span><span style=display:flex><span>git push --force heroku dist:master
</span></span><span style=display:flex><span><span style=color:#75715e># force push is needed, because a</span>
</span></span><span style=display:flex><span><span style=color:#75715e># new local branch is created on every deploy.</span>
</span></span><span style=display:flex><span>cd ..
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;- Cleanup&#34;</span>
</span></span><span style=display:flex><span>git worktree remove dist-folder
</span></span><span style=display:flex><span>git branch -D dist
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;- Done&#34;</span>
</span></span></code></pre></div><h3 id=git-commands-to-create-a-new-empty-parentless-branch>Git commands to create a new empty parentless branch<a hidden class=anchor aria-hidden=true href=#git-commands-to-create-a-new-empty-parentless-branch>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git checkout --orphan dist
</span></span><span style=display:flex><span>git reset --hard
</span></span><span style=display:flex><span>git clean -fd -e untracked-files/export
</span></span><span style=display:flex><span>git commit --allow-empty -m <span style=color:#e6db74>&#34;Create Empty Dist Branch&#34;</span>
</span></span><span style=display:flex><span>git checkout master
</span></span></code></pre></div><p>In order to create a new branch that does not have anything
inside <code>git checkout --orphan dist</code> is a good start,
it creates a new orphaned branch called <code>dist</code>.</p><p>After this script runs, we are taken to this new branch,
and every file in the work tree is in staged state.</p><p>Some say that <code>rm -rf .</code> is a good next step,
but for me it seems a bit dangerous.</p><p>I sticked with <code>git reset --hard; git clean -fd -e untracked-files/export</code>.
It unstages all the files, remove the modified files,
then clean all untracked files, except the ones in the excluded (<code>-e</code>) directories.</p><p>To create a branch I added a new empty commit, and headed back to the main branch.</p><h3 id=git-worktree>Git worktree<a hidden class=anchor aria-hidden=true href=#git-worktree>#</a></h3><p><a href=https://git-scm.com/docs/git-worktree>Git worktree</a>
is a way to manage multiple branches in the same repository.</p><p>To put it simple, it creates a folder, and when you
step into that folder, git acts like you&rsquo;ve checked out that branch.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git worktree add -f dist-folder dist
</span></span><span style=display:flex><span>cp -r anything/* dist-folder
</span></span><span style=display:flex><span>cd dist-folder
</span></span><span style=display:flex><span><span style=color:#75715e># now git thinks we&#39;ve checked out `dist`</span>
</span></span><span style=display:flex><span>git add .
</span></span><span style=display:flex><span>git commit -m <span style=color:#e6db74>&#39;Deploy to Heroku&#39;</span>
</span></span><span style=display:flex><span>git push --force heroku dist:master
</span></span><span style=display:flex><span>cd ..
</span></span><span style=display:flex><span><span style=color:#75715e># back in master</span>
</span></span><span style=display:flex><span>git worktree remove dist-folder
</span></span></code></pre></div><p>For my usecase it&rsquo;s perfect, I have an empty <code>dist</code> branch at this point,</p><ol><li>I check it out into a folder called <code>dist-folder</code></li><li>copy the necessary files</li><li>step into the worktree, so it seems like I&rsquo;ve checked out <code>dist</code></li><li>Stage the files, commit and deploy.</li><li>step out, so git thinks I&rsquo;m in <code>master</code>, and I can safely remove <code>dist-folder</code>.</li></ol><p>Since I create a new branch on every deploy,
I overwrite the contents of <code>master</code> branch in <code>heroku</code> remote.
Since pushes to that branch is only to trigger deployment,
I never check it out, I don&rsquo;t yet see a problem with this approach.</p><h2 id=disclaimer>Disclaimer<a hidden class=anchor aria-hidden=true href=#disclaimer>#</a></h2><p>I was not asked to create this post, and did not get anything for it,
I just wanted to share how simple it is to use and some of my experience with it.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://budavariam.github.io/tags/site-description/>site-description</a></li><li><a href=https://budavariam.github.io/tags/hosting/>hosting</a></li><li><a href=https://budavariam.github.io/tags/git/>git</a></li><li><a href=https://budavariam.github.io/tags/javascript/>javascript</a></li></ul><div class=share-buttons><div class=addthis_inline_share_toolbox></div><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-602c2f70bcebfd93"></script></div></div></footer><script async data-uid=7d9354cde4 src=https://fabulous-experimenter-1073.ck.page/7d9354cde4/index.js></script><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//budavariam.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2022 <a href=https://budavariam.github.io/>Mátyás Budavári</a></span>
<span>&#183;</span>
<wbr><span>Powered&nbsp;by&nbsp;<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<wbr><span>Theme&nbsp;<a href=https://github.com/budavariam/hugo-PaperMod/tree/budavariam rel=noopener target=_blank>PaperMod&nbsp;(custom)</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<script defer src=/assets/js/copybtn.min.4ca2683e6d39c944ce34447501348e9b7c2805874fc5f1023f9534ecd3dd2b59.js integrity="sha256-TKJoPm05yUTONER1ATSOm3woBYdPxfECP5U07NPdK1k="></script>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById("menu").scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById("menu").scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
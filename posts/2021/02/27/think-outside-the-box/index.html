<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Think Outside The Box | Mátyás Budavári</title><meta name=keywords content="developer-toolbox,productivity,ssh,tmux,screen,byobu"><meta name=description content="In the past few days I&rsquo;ve been working in manual mode on multiple linux boxes simultaneously.
I have to follow logs, modify configurations and kill/start applications all at once.
I got confused pretty fast of what server am I connected to in a certain console pane, and where are my operations.
On top of that my ISP had a huge traffic hit these days, and my VPN connection dropped constantly.
I dusted off my knowledge about some tools that boosted my productivity."><meta name=author content="Mátyás Budavári"><link rel=canonical href=http://budavariam.github.io/posts/2021/02/27/think-outside-the-box/><meta name=google-site-verification content="ocrG4G5ZSn2awC0mgHAsgk2qlhd3IAXCACgWNrqJcwY"><link href=/assets/css/stylesheet.min.c9f9aa52356f85ed41fec6cf7298763aa52dff31e80e6225ccfb71c0df2ba9f9.css integrity="sha256-yfmqUjVvhe1B/sbPcph2OqUt/zHoDmIlzPtxwN8rqfk=" rel="preload stylesheet" as=style><link rel=icon href=http://budavariam.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://budavariam.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://budavariam.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://budavariam.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://budavariam.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.80.0"><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-115499513-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Think Outside The Box"><meta property="og:description" content="In the past few days I&rsquo;ve been working in manual mode on multiple linux boxes simultaneously.
I have to follow logs, modify configurations and kill/start applications all at once.
I got confused pretty fast of what server am I connected to in a certain console pane, and where are my operations.
On top of that my ISP had a huge traffic hit these days, and my VPN connection dropped constantly.
I dusted off my knowledge about some tools that boosted my productivity."><meta property="og:type" content="article"><meta property="og:url" content="http://budavariam.github.io/posts/2021/02/27/think-outside-the-box/"><meta property="og:image" content="http://budavariam.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:published_time" content="2021-02-27T00:00:00+00:00"><meta property="article:modified_time" content="2021-02-27T00:00:00+00:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://budavariam.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Think Outside The Box"><meta name=twitter:description content="In the past few days I&rsquo;ve been working in manual mode on multiple linux boxes simultaneously.
I have to follow logs, modify configurations and kill/start applications all at once.
I got confused pretty fast of what server am I connected to in a certain console pane, and where are my operations.
On top of that my ISP had a huge traffic hit these days, and my VPN connection dropped constantly.
I dusted off my knowledge about some tools that boosted my productivity."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://budavariam.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Think Outside The Box","item":"http://budavariam.github.io/posts/2021/02/27/think-outside-the-box/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Think Outside The Box","name":"Think Outside The Box","description":"In the past few days I\u0026amp;rsquo;ve been working in manual mode on multiple linux boxes simultaneously. I have to follow logs, modify configurations and kill/start applications all at …","keywords":["developer-toolbox","productivity","ssh","tmux","screen","byobu"],"articleBody":"In the past few days I’ve been working in manual mode on multiple linux boxes simultaneously. I have to follow logs, modify configurations and kill/start applications all at once. I got confused pretty fast of what server am I connected to in a certain console pane, and where are my operations. On top of that my ISP had a huge traffic hit these days, and my VPN connection dropped constantly. I dusted off my knowledge about some tools that boosted my productivity.\nI usually don’t like to repeat myself, and supposedly I’ll have to do these modifications for many more machines. So as I see something is working, I take a note of the solution and create a script as I go. I have to see that it works manually, in order to automatize it.\nSSH SSH provides secure shell connection to a remote machine. You can work in it just like your local machine. There are multiple authentication methods, I found ssh public key auth feasible in my use case.\n put ssh keys into authorized-keys of the remote user simply, if you already have access to the server  ssh-copy-id    sshpass make it easy to use ssh-copy-id in a script  sshpass -p $secretpass ssh-copy-id    remember the passphrases of the ssh keys  ssh-add -K ${key_location}   ssh port forward  ssh -N -L LOCAL_PORT:localhost:REMOTE_PORT    copy keys to the server  scp ~/.ssh/my_keyprefix_* ':~/.ssh/'   start ssh service  sudo systemctl start ssh.service   attach to the already existing byobu session (see below):  ssh -t byobu    Where  is the data necessary to establish the ssh connection. Most likely an identity file and the server address: -i ~/.ssh/my_keyprefix.pem user@192.168.1.101. I think it’s better to use SSH Config. If you specify Host myserver in the config, you can use case myserver for the  part.\nSSH Permissions SSH is picky with the permission settings.\n The home folder that contains .ssh folder can not have group write permission. .ssh folder should have 700 octal permission .ssh/authorized_keys and public keys should have 644 octal permission .ssh/config should have 600 octal permission private keys under .ssh/ should have 600 octal permission  Permission basics Octal permissions in linux specify the permissions of the owner, group and others as the numbers respectively.\nThe permissions can be any combination of: read (4), write (2) and execute (1).\nWith that in mind: 644 permission means read permission for everyone, and an extra write permission for the owner.\nPermissions can be set with chmod command like: chmod $octal_permission filelist.\nSSH Config I think it’s amazing that you can collect ssh configurations under a custom name, and you can use that name to connect to the specified server.\nYou need to set the necessary data into:~/.ssh/config.\nHost server-1 User customuser HostName 192.168.42.123 IdentityFile /var/opt/customdata/.ssh/id_ed25519 I used rsync to keep some code up to date in my systems, and it made the code significantly easier and less error prone to reference the ssh config already set, instead of typing it out.\nRsync does not proide automatic resync out of the box, but a little bash magic can do wonders.\nprojectpath=\"~/projects/thisproject\" machine=\"server-1\" # this is the Host in .ssh/config run_rsync() { rsync -azuv --no-o --no-g \\  --exclude \"logs\" \\  --exclude \".git\" \\  \"${projectpath}\" \\  \"$machine\":/opt } run_rsync; fswatch -o \"${projectpath}\" | \\  while read f; do run_rsync; done Debug SSH connection problems You can debug ssh issues with the verbose flag on the client side, e.g: ssh -vvv server-1.\nIf you need to debug your issues on the server side, you can set the ssh service to print debug logs by setting LogLevel DEBUG in /etc/ssh/sshd_config. You need to restart the sshd service to apply this modification. systemctl restart sshd\nView the logs with e.g: journalctl -f -u sshd.\nIn my case I needed to access a user that had his home folder outside /home AND had his password locked. On top of that their home folder had group write permissions by default. Such a thrill.\nLocked password The locked password made it harder to put out the ssh key, there are 2 simple solutions to choose from\nOne would be to set a password manually with: passwd customuser as a root user, then use ssh=copy-id as usual, and finally lock the password again with passwd --lock customuser.\nThe other solution is to append the public key manually to ~customuser/.ssh/authorized_keys.\nHome folder outside /home In my case selinux did not know that this folder can be used as an ssh_home folder. These few lines permanently fixed it.\nsudo semanage fcontext -a -t ssh_home_t ~customuser/.ssh/authorized_keys sudo semanage fcontext -a -t ssh_home_t ~customuser/.ssh sudo restorecon -R -v ~customuser/.ssh/ chmod g-w ~customuser Welcome message When I log in to a box, I found it beneficial to print a huge unique identifier of where I logged in exactly. It made it easier to keep track of what’s happening.\nI found a great tool called FIGlet, that can generate ASCII art like text from ordinary text. As a small practice project, in my free time I put together a simple webapp to showcase an already existing JS renderer.\n____ _____ ____ __ __ _____ ____ _ / ___| | ____|| _ \\\\ \\ / /| ____|| _ \\ / | \\___ \\ | _| | |_) |\\ \\ / / | _| | |_) | _____ | | ___) || |___ | _ But of course I could have just used cowsay.\n________________________________ -------------------------------- \\ ^__^ \\ (oo)\\_______ (__)\\ )\\/\\ ||----w | || || Set SSH banner SSH banner prints a message when an ssh session connects, before the used logs in.\nI aimed for a simple banner, centos have a wiki page that explains the simple steps to achieve it, but since it’s ssh config it should work similarly in other distributions.\n Create a /etc/issue.net file and fill it with the desired plaintext context Edit /etc/ssh/sshd_config, to have this line: Banner /etc/issue.net Restart sshd: systemctl restart sshd  In linux you can specify welcome messages, when you log in, it’s called Message Of The Day or MOTD for short. That opens up after the user has logged in, and before the shell started up. It can be cpntrolled usually in /etc/motd.\nTerminal multiplexers Terminal multiplexers make it easy to manage long running processes in remote machines. They’re especially useful if you have an unreliable network connection, you can start up a session in the remote machine, and when you log in to the machine the next time, you can connect to the same session.\nThey let you create multiple windows/panes, thus provide a better experience than forward/background jobs.\nYou can have multiple sessions in a machine at a given time, multiple users can log in to them.\nYou can use it in your local machine as well, and log in to it from multiple shell emulators if that’s what you need.\nScreen and tmux GNU screen is there since 1987, widely available.\nscreen -S sessionName # create session with a name screen -r sessionName # reconnect to named session screen -ls # list current sessions screen -XS sessionName quit # terminate session screen -r -d # reconnect to the last session screen -xr # share screen tmux is newer, created in 2007, has a huge community around it. They operate with key chords, both have a meta character that marks the actions for the multiplexer.\ntmux new -s session_name # create session with a name tmux attach-session -t session_name # reconnect to named session tmux ls # list current sessions tmux kill-session -t session_name # terminate session tmux new -As0 # attach to default session if exists Byobu My favourite is byobu, it’s a config layer over the other two above. It provides a simple interface for their functionalities. Byobu maps its functionality to the F1-F12 keys.\nYou can use the key chords that you’re used to, even select the underlying backend on start.\nbyobu byobu-screen # any tmux options can be given byobu-tmux # any screen options can be given Basic Keybinding comparison    Byobu Tmux Screen Description      CTRL+b CTRL-a default meta   shift+F1 meta ? meta ? help   F6 meta d meta d detach from session         F2 meta c meta CTRL-C create new tab    meta w meta \" choose tab from a list   F3 meta n meta CTRL-N next tab   F4 meta p meta CTRL-P prev tab    meta 0 meta CTRL-0 switch to tab (0 can be any number)         shift+F2 meta \" meta SHIFT-s split horizontally   CTRL+F2 meta % meta | split vertically    meta o meta TAB switch to pane    meta x meta SHIFT-x close the pane that has focus   F8 meta , meta SHIFT-a rename tab   F7 meta [ meta ESC start scroll mode    meta q  show pane numbers if you press a number the cursor will jump to it    meta ;  toggle between prev/current pane    meta SPACE  toggle between layouts    meta z  toggle zoom to pane     Note that Byobu can use the underlying backend’s keybindings as well.\n Happy coding!\n","wordCount":"1515","inLanguage":"en","datePublished":"2021-02-27T00:00:00Z","dateModified":"2021-02-27T00:00:00Z","author":{"@type":"Person","name":"Mátyás Budavári"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://budavariam.github.io/posts/2021/02/27/think-outside-the-box/"},"publisher":{"@type":"Organization","name":"Mátyás Budavári","logo":{"@type":"ImageObject","url":"http://budavariam.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=http://budavariam.github.io/ accesskey=h title="Mátyás Budavári (Alt + H)" class=site-avatar><img src=/avatar.png alt=logo aria-label=logo height=70></a><div class=site-info><h1 class=site-name><a href=http://budavariam.github.io/ accesskey=h title="Mátyás Budavári (Alt + H)">Mátyás Budavári</a></h1><p class=site-description>Developer from Szeged</p></div></div><ul id=menu onscroll=menu_on_scroll()><li><a href=http://budavariam.github.io/about/ title=About><span>About</span></a></li><li><a href=http://budavariam.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=http://budavariam.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://budavariam.github.io/archives/ title=Archive><span>Archive</span></a></li><span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Think Outside The Box</h1><div class=post-meta>February 27, 2021&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Mátyás Budavári</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#ssh aria-label=SSH>SSH</a><ul><li><a href=#ssh-permissions aria-label="SSH Permissions">SSH Permissions</a><ul><li><a href=#permission-basics aria-label="Permission basics">Permission basics</a></li></ul></li><li><a href=#ssh-config aria-label="SSH Config">SSH Config</a></li><li><a href=#debug-ssh-connection-problems aria-label="Debug SSH connection problems">Debug SSH connection problems</a><ul><li><a href=#locked-password aria-label="Locked password">Locked password</a></li><li><a href=#home-folder-outside-home aria-label="Home folder outside /home">Home folder outside /home</a></li></ul></li></ul></li><li><a href=#welcome-message aria-label="Welcome message">Welcome message</a><ul><li><a href=#set-ssh-banner aria-label="Set SSH banner">Set SSH banner</a></li></ul></li><li><a href=#terminal-multiplexers aria-label="Terminal multiplexers">Terminal multiplexers</a></li><li><a href=#screen-and-tmux aria-label="Screen and tmux">Screen and tmux</a><ul><li><a href=#byobu aria-label=Byobu>Byobu</a></li><li><a href=#basic-keybinding-comparison aria-label="Basic Keybinding comparison">Basic Keybinding comparison</a></li></ul></li></ul></div></details></div><div class=post-content><p>In the past few days I&rsquo;ve been working in manual mode on multiple linux boxes simultaneously.
I have to follow logs, modify configurations and kill/start applications all at once.
I got confused pretty fast of what server am I connected to in a certain console pane, and where are my operations.
On top of that my ISP had a huge traffic hit these days, and my VPN connection dropped constantly.
I dusted off my knowledge about some tools that boosted my productivity.</p><p>I usually don&rsquo;t like to repeat myself, and supposedly I&rsquo;ll have to do these modifications for many more machines.
So as I see something is working, I take a note of the solution and create a script as I go.
I have to see that it works manually, in order to automatize it.</p><h2 id=ssh>SSH<a hidden class=anchor aria-hidden=true href=#ssh>#</a></h2><p>SSH provides secure shell connection to a remote machine. You can work in it just like your local machine.
There are multiple authentication methods, I found ssh public key auth feasible in my use case.</p><ul><li>put ssh keys into <code>authorized-keys</code> of the remote user simply, if you already have access to the server<ul><li><code>ssh-copy-id &lt;connection></code></li></ul></li><li><a href=https://linux.die.net/man/1/sshpass>sshpass</a> make it easy to use <code>ssh-copy-id</code> in a script<ul><li><code>sshpass -p $secretpass ssh-copy-id &lt;connection></code></li></ul></li><li>remember the passphrases of the ssh keys<ul><li><code>ssh-add -K ${key_location}</code></li></ul></li><li>ssh port forward<ul><li><code>ssh -N -L LOCAL_PORT:localhost:REMOTE_PORT &lt;connection></code></li></ul></li><li>copy keys to the server<ul><li><code>scp ~/.ssh/my_keyprefix_* '&lt;connection>:~/.ssh/'</code></li></ul></li><li>start ssh service<ul><li><code>sudo systemctl start ssh.service</code></li></ul></li><li>attach to the already existing byobu session (see <a href=#byobu>below</a>):<ul><li><code>ssh -t byobu</code></li></ul></li></ul><p>Where <code>&lt;connection></code> is the data necessary to establish the ssh connection.
Most likely an identity file and the server address: <code>-i ~/.ssh/my_keyprefix.pem user@192.168.1.101</code>.
I think it&rsquo;s better to use <a href=#ssh-config>SSH Config</a>.
If you specify <code>Host myserver</code> in the config, you can use case <code>myserver</code> for the <code>&lt;connection></code> part.</p><h3 id=ssh-permissions>SSH Permissions<a hidden class=anchor aria-hidden=true href=#ssh-permissions>#</a></h3><p>SSH is picky with the permission settings.</p><ul><li>The home folder that contains <code>.ssh</code> folder can not have group write permission.</li><li><code>.ssh</code> folder should have <code>700</code> octal permission</li><li><code>.ssh/authorized_keys</code> and public keys should have <code>644</code> octal permission</li><li><code>.ssh/config</code> should have <code>600</code> octal permission</li><li>private keys under <code>.ssh/</code> should have <code>600</code> octal permission</li></ul><h4 id=permission-basics>Permission basics<a hidden class=anchor aria-hidden=true href=#permission-basics>#</a></h4><p>Octal permissions in linux specify the permissions of the <strong>owner</strong>, <strong>group</strong> and <strong>others</strong> as the numbers respectively.</p><p>The permissions can be any combination of: <strong>read</strong> (4), <strong>write</strong> (2) and <strong>execute</strong> (1).</p><p>With that in mind: <code>644</code> permission means <strong>read</strong> permission for everyone, and an extra <strong>write</strong> permission for the <strong>owner</strong>.</p><p>Permissions can be set with <code>chmod</code> command like: <code>chmod $octal_permission filelist</code>.</p><h3 id=ssh-config>SSH Config<a hidden class=anchor aria-hidden=true href=#ssh-config>#</a></h3><p>I think it&rsquo;s amazing that you can collect ssh configurations under a custom name,
and you can use that name to connect to the specified server.</p><p>You need to set the necessary data into:<code>~/.ssh/config</code>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Host server-1
    User customuser
    HostName 192.168.42.123
    IdentityFile /var/opt/customdata/.ssh/id_ed25519
</code></pre></div><p>I used <a href=https://en.wikipedia.org/wiki/Rsync>rsync</a> to keep some code up to date in my systems,
and it made the code significantly easier and less error prone to reference the ssh config already set, instead of typing it out.</p><p>Rsync does not proide automatic resync out of the box, but a little bash magic can do wonders.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>projectpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;~/projects/thisproject&#34;</span>
machine<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;server-1&#34;</span> <span style=color:#75715e># this is the Host in .ssh/config</span>
run_rsync<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
  rsync -azuv --no-o --no-g <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --exclude <span style=color:#e6db74>&#34;logs&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    --exclude <span style=color:#e6db74>&#34;.git&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>projectpath<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    <span style=color:#e6db74>&#34;</span>$machine<span style=color:#e6db74>&#34;</span>:/opt
<span style=color:#f92672>}</span>
run_rsync; fswatch -o <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>projectpath<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> | <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    <span style=color:#66d9ef>while</span> read f; <span style=color:#66d9ef>do</span> run_rsync; <span style=color:#66d9ef>done</span>
</code></pre></div><h3 id=debug-ssh-connection-problems>Debug SSH connection problems<a hidden class=anchor aria-hidden=true href=#debug-ssh-connection-problems>#</a></h3><p>You can debug ssh issues with the verbose flag on the client side, e.g: <code>ssh -vvv server-1</code>.</p><p>If you need to debug your issues on the server side, you can set the ssh service to print debug logs by setting <code>LogLevel DEBUG</code> in <code>/etc/ssh/sshd_config</code>. You need to restart the sshd service to apply this modification. <code>systemctl restart sshd</code></p><p>View the logs with e.g: <code>journalctl -f -u sshd</code>.</p><p>In my case I needed to access a user that had his home folder outside <code>/home</code> AND had his password locked.
On top of that their home folder had group write permissions by default.
Such a thrill.</p><h4 id=locked-password>Locked password<a hidden class=anchor aria-hidden=true href=#locked-password>#</a></h4><p>The locked password made it harder to put out the ssh key, there are 2 simple solutions to choose from</p><p>One would be to set a password manually with: <code>passwd customuser</code> as a root user, then use <code>ssh=copy-id</code> as usual, and finally lock the password again with <code>passwd --lock customuser</code>.</p><p>The other solution is to append the public key manually to <code>~customuser/.ssh/authorized_keys</code>.</p><h4 id=home-folder-outside-home>Home folder outside /home<a hidden class=anchor aria-hidden=true href=#home-folder-outside-home>#</a></h4><p>In my case selinux did not know that this folder can be used as an ssh_home folder.
These few lines permanently fixed it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo semanage fcontext -a -t ssh_home_t ~customuser/.ssh/authorized_keys
sudo semanage fcontext -a -t ssh_home_t ~customuser/.ssh
sudo restorecon -R -v ~customuser/.ssh/
chmod g-w ~customuser
</code></pre></div><h2 id=welcome-message>Welcome message<a hidden class=anchor aria-hidden=true href=#welcome-message>#</a></h2><p>When I log in to a box, I found it beneficial to print a huge unique identifier of where I logged in exactly.
It made it easier to keep track of what&rsquo;s happening.</p><p>I found a great tool called <a href=http://www.figlet.org/>FIGlet</a>, that can generate ASCII art like text from ordinary text.
As a small practice project, in my free time I put together
a simple <a href=https://budavariam.github.io/asciiart-text/>webapp</a> to showcase an already existing
<a href=https://github.com/scottgonzalez/figlet-js>JS renderer</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>  ____   _____  ____ __     __ _____  ____            _
 / ___| | ____||  _ \\ \   / /| ____||  _ \          / |
 \___ \ |  _|  | |_) |\ \ / / |  _|  | |_) |  _____  | |
  ___) || |___ |  _ &lt;  \ V /  | |___ |  _ &lt;  |_____| | |
 |____/ |_____||_| \_\  \_/   |_____||_| \_\         |_|
</code></pre></div><p>But of course I could have just used <a href=https://en.wikipedia.org/wiki/Cowsay>cowsay</a>.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text> ________________________________
&lt; Welcome to St. James Ballroom! &gt;
 --------------------------------
        \   ^__^
         \  (oo)\_______
            (__)\       )\/\
                ||----w |
                ||     ||
</code></pre></div><h3 id=set-ssh-banner>Set SSH banner<a hidden class=anchor aria-hidden=true href=#set-ssh-banner>#</a></h3><p>SSH banner prints a message when an ssh session connects, before the used logs in.</p><p>I aimed for a simple banner, centos have a <a href=https://wiki.centos.org/TipsAndTricks/BannerFiles>wiki page</a>
that explains the simple steps to achieve it, but since it&rsquo;s ssh config it should work similarly in other distributions.</p><ol><li>Create a <code>/etc/issue.net</code> file and fill it with the desired plaintext context</li><li>Edit <code>/etc/ssh/sshd_config</code>, to have this line: <code>Banner /etc/issue.net</code></li><li>Restart sshd: <code>systemctl restart sshd</code></li></ol><p>In linux you can specify welcome messages, when you log in, it&rsquo;s called Message Of The Day or MOTD for short.
That opens up after the user has logged in, and before the shell started up.
It can be cpntrolled usually in <code>/etc/motd</code>.</p><h2 id=terminal-multiplexers>Terminal multiplexers<a hidden class=anchor aria-hidden=true href=#terminal-multiplexers>#</a></h2><p>Terminal multiplexers make it easy to manage long running processes in remote machines.
They&rsquo;re especially useful if you have an unreliable network connection,
you can start up a session in the remote machine,
and when you log in to the machine the next time, you can connect to the same session.</p><p>They let you create multiple windows/panes, thus provide a better experience than forward/background jobs.</p><p>You can have multiple sessions in a machine at a given time, multiple users can log in to them.</p><p>You can use it in your local machine as well, and log in to it from multiple shell emulators if that&rsquo;s what you need.</p><h2 id=screen-and-tmux>Screen and tmux<a hidden class=anchor aria-hidden=true href=#screen-and-tmux>#</a></h2><p><a href=https://www.gnu.org/software/screen/>GNU screen</a> is there since 1987, widely available.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>screen -S sessionName       <span style=color:#75715e># create session with a name</span>
screen -r sessionName       <span style=color:#75715e># reconnect to named session</span>
screen -ls                  <span style=color:#75715e># list current sessions</span>
screen -XS sessionName quit <span style=color:#75715e># terminate session</span>
screen -r -d                <span style=color:#75715e># reconnect to the last session</span>
screen -xr                  <span style=color:#75715e># share screen</span>
</code></pre></div><p><a href=https://github.com/tmux/tmux/wiki>tmux</a> is newer, created in 2007, has a huge community around it.
They operate with key chords, both have a meta character that marks the actions for the multiplexer.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>tmux new -s session_name            <span style=color:#75715e># create session with a name</span>
tmux attach-session -t session_name <span style=color:#75715e># reconnect to named session</span>
tmux ls                             <span style=color:#75715e># list current sessions</span>
tmux kill-session -t session_name   <span style=color:#75715e># terminate session</span>
tmux new -As0              <span style=color:#75715e># attach to default session if exists</span>
</code></pre></div><p><img src=/images/2021-02-27-think-outside-the-box-tmux.png alt="tmux layout"></p><h3 id=byobu>Byobu<a hidden class=anchor aria-hidden=true href=#byobu>#</a></h3><p>My favourite is <a href=https://www.byobu.org/>byobu</a>, it&rsquo;s a config layer over the other two above.
It provides a simple interface for their functionalities.
Byobu maps its functionality to the F1-F12 keys.</p><p>You can use the key chords that you&rsquo;re used to, even select the underlying backend on start.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>byobu
byobu-screen  <span style=color:#75715e># any tmux options can be given</span>
byobu-tmux    <span style=color:#75715e># any screen options can be given</span>
</code></pre></div><h3 id=basic-keybinding-comparison>Basic Keybinding comparison<a hidden class=anchor aria-hidden=true href=#basic-keybinding-comparison>#</a></h3><table><thead><tr><th style=text-align:left>Byobu</th><th style=text-align:left>Tmux</th><th style=text-align:left>Screen</th><th style=text-align:left>Description</th></tr></thead><tbody><tr><td style=text-align:left></td><td style=text-align:left>CTRL+b</td><td style=text-align:left>CTRL-a</td><td style=text-align:left>default meta</td></tr><tr><td style=text-align:left>shift+F1</td><td style=text-align:left>meta ?</td><td style=text-align:left>meta ?</td><td style=text-align:left>help</td></tr><tr><td style=text-align:left>F6</td><td style=text-align:left>meta d</td><td style=text-align:left>meta d</td><td style=text-align:left>detach from session</td></tr><tr><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left></td></tr><tr><td style=text-align:left>F2</td><td style=text-align:left>meta c</td><td style=text-align:left>meta CTRL-C</td><td style=text-align:left>create new tab</td></tr><tr><td style=text-align:left></td><td style=text-align:left>meta w</td><td style=text-align:left>meta "</td><td style=text-align:left>choose tab from a list</td></tr><tr><td style=text-align:left>F3</td><td style=text-align:left>meta n</td><td style=text-align:left>meta CTRL-N</td><td style=text-align:left>next tab</td></tr><tr><td style=text-align:left>F4</td><td style=text-align:left>meta p</td><td style=text-align:left>meta CTRL-P</td><td style=text-align:left>prev tab</td></tr><tr><td style=text-align:left></td><td style=text-align:left>meta 0</td><td style=text-align:left>meta CTRL-0</td><td style=text-align:left>switch to tab (0 can be any number)</td></tr><tr><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left></td><td style=text-align:left></td></tr><tr><td style=text-align:left>shift+F2</td><td style=text-align:left>meta "</td><td style=text-align:left>meta SHIFT-s</td><td style=text-align:left>split horizontally</td></tr><tr><td style=text-align:left>CTRL+F2</td><td style=text-align:left>meta %</td><td style=text-align:left>meta |</td><td style=text-align:left>split vertically</td></tr><tr><td style=text-align:left></td><td style=text-align:left>meta o</td><td style=text-align:left>meta TAB</td><td style=text-align:left>switch to pane</td></tr><tr><td style=text-align:left></td><td style=text-align:left>meta x</td><td style=text-align:left>meta SHIFT-x</td><td style=text-align:left>close the pane that has focus</td></tr><tr><td style=text-align:left>F8</td><td style=text-align:left>meta ,</td><td style=text-align:left>meta SHIFT-a</td><td style=text-align:left>rename tab</td></tr><tr><td style=text-align:left>F7</td><td style=text-align:left>meta [</td><td style=text-align:left>meta ESC</td><td style=text-align:left>start scroll mode</td></tr><tr><td style=text-align:left></td><td style=text-align:left>meta q</td><td style=text-align:left></td><td style=text-align:left>show pane numbers if you press a number the cursor will jump to it</td></tr><tr><td style=text-align:left></td><td style=text-align:left>meta ;</td><td style=text-align:left></td><td style=text-align:left>toggle between prev/current pane</td></tr><tr><td style=text-align:left></td><td style=text-align:left>meta SPACE</td><td style=text-align:left></td><td style=text-align:left>toggle between layouts</td></tr><tr><td style=text-align:left></td><td style=text-align:left>meta z</td><td style=text-align:left></td><td style=text-align:left>toggle zoom to pane</td></tr></tbody></table><blockquote><p>Note that Byobu can use the underlying backend&rsquo;s keybindings as well.</p></blockquote><p>Happy coding!</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://budavariam.github.io/tags/developer-toolbox/>developer-toolbox</a></li><li><a href=http://budavariam.github.io/tags/productivity/>productivity</a></li><li><a href=http://budavariam.github.io/tags/ssh/>ssh</a></li><li><a href=http://budavariam.github.io/tags/tmux/>tmux</a></li><li><a href=http://budavariam.github.io/tags/screen/>screen</a></li><li><a href=http://budavariam.github.io/tags/byobu/>byobu</a></li></ul><div class=share-buttons><div class=addthis_inline_share_toolbox></div><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-602c2f70bcebfd93"></script></div></div></footer><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"budavariam"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2021 <a href=http://budavariam.github.io/>Mátyás Budavári</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.27cd435cc9ed6abb4b496581b151804f79f366c412620272bb94e2f5f598ebcc.js integrity="sha256-J81DXMntartLSWWBsVGAT3nzZsQSYgJyu5Ti9fWY68w=" onload=hljs.initHighlightingOnLoad();></script><script>window.onload=function(){if(localStorage.getItem("menu-scroll-position")){document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position");}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft);}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script></body></html>
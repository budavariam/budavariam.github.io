<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Strava Activities With Plotly | Mátyás Budavári</title><meta name=keywords content="dataviz,plotly,dash,strava,docker,github-actions"><meta name=description content="I started to run on a weekly basis in last August, I&rsquo;m fascinated with the data I can collect from each run.
I&rsquo;ve been using Strava ever since.
While I was preparing for my previous post about plotly-dash,
I decided to dust off my knowledge by creating a simple app to visualize my heartrate data in different activities."><meta name=author content="Mátyás Budavári"><meta name=theme-color content="#317EFB"><link rel=canonical href=https://budavariam.github.io/posts/2021/04/08/strava-activities-with-plotly/><meta name=google-site-verification content="ocrG4G5ZSn2awC0mgHAsgk2qlhd3IAXCACgWNrqJcwY"><link href=/assets/css/stylesheet.min.8992a6674f694d99a84bca35962c31e8f7c81352f54d3e95def071e7d30507dd.css integrity="sha256-iZKmZ09pTZmoS8o1liwx6PfIE1L1TT6V3vBx59MFB90=" rel="preload stylesheet" as=style><script src=https://kit.fontawesome.com/68da183384.js crossorigin=anonymous></script>
<link rel=icon href=https://budavariam.github.io/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://budavariam.github.io/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://budavariam.github.io/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://budavariam.github.io/favicon/apple-icon-180x180.png><link rel=mask-icon href=https://budavariam.github.io/favicon/apple-icon-180x180.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.96.0"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-115499513-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Strava Activities With Plotly"><meta property="og:description" content="I started to run on a weekly basis in last August, I&rsquo;m fascinated with the data I can collect from each run.
I&rsquo;ve been using Strava ever since.
While I was preparing for my previous post about plotly-dash,
I decided to dust off my knowledge by creating a simple app to visualize my heartrate data in different activities."><meta property="og:type" content="article"><meta property="og:url" content="https://budavariam.github.io/posts/2021/04/08/strava-activities-with-plotly/"><meta property="og:image" content="https://budavariam.github.io/images/2021-04-08-strava-activities-with-plotly/cover.png"><meta property="article:published_time" content="2021-04-08T00:00:00+00:00"><meta property="article:modified_time" content="2021-04-08T00:00:00+00:00"><meta property="og:site_name" content="Mátyás Budavári"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://budavariam.github.io/images/2021-04-08-strava-activities-with-plotly/cover.png"><meta name=twitter:title content="Strava Activities With Plotly"><meta name=twitter:description content="I started to run on a weekly basis in last August, I&rsquo;m fascinated with the data I can collect from each run.
I&rsquo;ve been using Strava ever since.
While I was preparing for my previous post about plotly-dash,
I decided to dust off my knowledge by creating a simple app to visualize my heartrate data in different activities."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://budavariam.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Strava Activities With Plotly","item":"https://budavariam.github.io/posts/2021/04/08/strava-activities-with-plotly/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Strava Activities With Plotly","name":"Strava Activities With Plotly","description":"I started to run on a weekly basis in last August, I\u0026amp;rsquo;m fascinated with the data I can collect from each run. I\u0026amp;rsquo;ve been using Strava ever since. While I was preparing …","keywords":["dataviz","plotly","dash","strava","docker","github-actions"],"articleBody":"I started to run on a weekly basis in last August, I’m fascinated with the data I can collect from each run. I’ve been using Strava ever since. While I was preparing for my previous post about plotly-dash, I decided to dust off my knowledge by creating a simple app to visualize my heartrate data in different activities.\nWhen I started out with plotly-dash development the most confusing part for me was that I already knew plotly as a js chart lib, not as python code.\nWith dash you can basically write your component interactions in python. For simple usecases you would not need to write any javascript at all. Under the hood it serves a React app and renders the same js plotly lib I was familiar with.\nNow let’s see the interesting parts from this github repository. Live site is available here.\nAuthentication In dash applications all the necessary elements have to be rendered on startup. I have a simple and straightforward layout, one div for authenticated and one for unauthenticated items.\nA single callback manages the login flow with the help of stravalib.\nThe auth flow was hugely inspired by AartGoossens/strava-dash-boilerplate. The difference is that they switch rendered items, but I can not live with such dash warnings and errors during development.\nStatic files and Clientside callbacks Dash looks for files automagically from the assets folder. In order to serve images I could simply reference them from this assets folder, but I wanted to see if I can have more control over it.\nI added a simple clientside callback just for showcase, it could be done in python side.\nSimple way You can use /assets/ prefix for your asset paths by default.\napp = dash.Dash(__name__)  app.layout = html.Div([  html.Img(src='/assets/image.png') ]) Flask Routes You can use custom path with @app.server.route.\nfrom flask import send_from_directory  app = dash.Dash(__name__) @app.server.route('/static/') def serve_static(path):  return send_from_directory('assets', path) Custom Component I added the custom component to the same repository for simplicity. It could live on its own.\nI like that I can develop components in React.\nDemo React page The demo page is tweakable and it can showcase different usecases, similar to storybook. It’s a separate app.\n{  \"scripts\": {  \"build:demo\": \"webpack --mode production --config ./webpack.serve.config.js\"  } } I added a simple github actions script to deploy to github-pages. You can see it live here.\njobs:  deploy:  runs-on: ubuntu-latest  strategy:  matrix:  node-version: [14.x]  steps:  - uses: actions/checkout@v1  - name: Use Node.js ${{ matrix.node-version }}  uses: actions/setup-node@v1  with:  node-version: ${{ matrix.node-version }}  - name: Install Packages  run: cd ./activity_selector \u0026\u0026 npm install  - name: Build page  run: cd ./activity_selector \u0026\u0026 npm run build:demo  - name: Deploy to gh-pages  uses: peaceiris/actions-gh-pages@v3  with:  publish_dir: ./activity_selector/dist  github_token: ${{ secrets.GITHUB_TOKEN }} Deploy new version The base cookiecutter scripts do not provide good packaging script by default I usually roll my own solutions for it.\n{  \"scripts\": {  \"presdist\": \"npm run build\",  \"sdist\": \"rm -r ./dist/; python setup.py sdist\",  \"postsdist\": \"(. venv/bin/activate || venv\\\\scripts\\\\activate \u0026\u0026 bash ./script_postsdist.sh)\",  \"sdist:version:activated\": \"(. venv/bin/activate || venv\\\\scripts\\\\activate \u0026\u0026 npm version patch \u0026\u0026 npm run sdist)\",  \"sdist:activated\": \"(. venv/bin/activate || venv\\\\scripts\\\\activate \u0026\u0026 npm run sdist)\"  } } #!/bin/bash ## script_postsdist.sh  # assume that the virtual env has been activated and pwd is the project root directory pushd .. rm ./activity_selector-*.tar.gz mv ./activity_selector/dist/activity_selector-* . NEW_FILE=$(find . -name 'activity_selector*' -maxdepth 1 | head -1 | xargs basename) sed -i.bak \"s/activity_selector-\\S*/$NEW_FILE/\" ./requirements.txt rm ./*.bak pip install \"./$NEW_FILE\"  popd || exit 1 With a simple cd activity_selector \u0026\u0026 npm run sdist:version:activated command (after dependency installs), I can update the package in my app, it rewires the dependencies as well.\nDockerize environment In order to see how it looks in the deploy environment in an easily reproducible way I decided to dockerize the app.\nMultistage build keeps my image small, the base image and requirements.txt keeps my dependencies the same between installs. Gunicorn provides a production grade server to deploy the app.\nFROMpython:3.6.13 as baseFROMbase as builderRUN mkdir /installWORKDIR/installCOPY requirements.txt /requirements.txtCOPY ./*.tar.gz .RUN pip install --no-cache-dir --prefix=/install --no-warn-script-location -r /requirements.txtFROMbaseCOPY --from=builder /install /usr/localWORKDIR/appRUN mkdir -p logsCOPY ./src ./srcCOPY ./assets ./assetsCOPY ./logconfig.conf ./logconfig.confEXPOSE5000CMD gunicorn --bind 0.0.0.0:5000 --chdir ./src --log-config /app/logconfig.conf app:serverDevelopment experience I debugged my code from VSCode. Kept my config variables in a .env file in the project root folder.\n{  // Use IntelliSense to learn about possible attributes.  // Hover to view descriptions of existing attributes.  // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387  \"version\": \"0.2.0\",  \"configurations\": [  {  \"name\": \"Start Dev Server\",  \"type\": \"python\",  \"request\": \"launch\",  \"program\": \"${workspaceRoot}/src/app.py\",  \"console\": \"integratedTerminal\",  \"env\": {  \"DEBUG\": \"true\",  \"PYTHONPATH\": \"${workspaceRoot}/src\"  },  \"envFile\": \"${workspaceRoot}/.env\",  \"python\": \"${workspaceRoot}/src/venv/bin/python\",  \"justMyCode\": true  }  ] } I used 3 separate terminals:\n cd activity_selector \u0026\u0026 npm start to continously build the custom component. See changes live at http://0.0.0.0:55554. One console to run VSCode debugger at One open console to update the component in the root app with: pip install -e ./activity_selector  I had much fun creating these configs for the project.\nHappy Coding!\n","wordCount":"822","inLanguage":"en","image":"https://budavariam.github.io/images/2021-04-08-strava-activities-with-plotly/cover.png","datePublished":"2021-04-08T00:00:00Z","dateModified":"2021-04-08T00:00:00Z","author":{"@type":"Person","name":"Mátyás Budavári"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://budavariam.github.io/posts/2021/04/08/strava-activities-with-plotly/"},"publisher":{"@type":"Organization","name":"Mátyás Budavári","logo":{"@type":"ImageObject","url":"https://budavariam.github.io/favicon/favicon.ico"}}}</script><script src=https://cdn.lr-ingest.io/LogRocket.min.js crossorigin=anonymous></script>
<script>window.LogRocket&&window.LogRocket.init("0igxfm/budavariam-blog"),window.LogRocket.getSessionURL(function(e){ga("send",{hitType:"event",eventCategory:"LogRocket",eventAction:e})})</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://budavariam.github.io/ title="Mátyás Budavári (Alt + H)" class=site-avatar><img src=/avatar.png alt=logo aria-label=logo height=70 width=70></a><div class=site-info><h1 class=site-name><a href=https://budavariam.github.io/ accesskey=h title="Mátyás Budavári (Alt + H)">Mátyás Budavári</a></h1><p class=site-description>Developer from Szeged</p></div></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://budavariam.github.io/about/ title=About><span>About</span></a></li><li><a href=https://budavariam.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://budavariam.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://budavariam.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://budavariam.github.io/projects/ title=Projects><span>Projects</span></a></li><li><span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Strava Activities With Plotly</h1><div class=post-meta>April 8, 2021&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Mátyás Budavári
|&nbsp;<a class=edit-post href=https://github.com/budavariam/budavariam.github.io/blob/main/content/posts/2021-04-08-strava-activities-with-plotly.md rel="noopener noreferrer" target=_blank>Make it better</a></div></header><figure class=entry-cover><img src=https://budavariam.github.io/images/2021-04-08-strava-activities-with-plotly/cover.png alt="Plotly and Strava logo"></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#authentication aria-label=Authentication>Authentication</a><ul><li><a href=#static-files-and-clientside-callbacks aria-label="Static files and Clientside callbacks">Static files and Clientside callbacks</a><ul><li><a href=#simple-way aria-label="Simple way">Simple way</a></li><li><a href=#flask-routes aria-label="Flask Routes">Flask Routes</a></li></ul></li></ul></li><li><a href=#custom-component aria-label="Custom Component">Custom Component</a><ul><li><a href=#demo-react-page aria-label="Demo React page">Demo React page</a></li><li><a href=#deploy-new-version aria-label="Deploy new version">Deploy new version</a></li></ul></li><li><a href=#dockerize-environment aria-label="Dockerize environment">Dockerize environment</a><ul><li><a href=#development-experience aria-label="Development experience">Development experience</a></li></ul></li></ul></div></details></div><div class=post-content><p>I started to run on a weekly basis in last August, I&rsquo;m fascinated with the data I can collect from each run.
I&rsquo;ve been using Strava ever since.
While I was preparing for my <a href=/posts/2021/04/05/plotly-dash-development-tips/>previous post about plotly-dash</a>,
I decided to dust off my knowledge by creating a simple app to visualize my heartrate data in different activities.</p><p>When I started out with plotly-dash development the most confusing part for me was
that I already knew plotly as a js chart lib, not as python code.</p><p>With dash you can basically write your component interactions in python.
For simple usecases you would not need to write any javascript at all.
Under the hood it serves a React app and renders the same js plotly lib I was familiar with.</p><p>Now let&rsquo;s see the interesting parts from this <a href=https://github.com/budavariam/activity-visualizer>github repository</a>.
Live site is available <a href=https://activity-visualizer.herokuapp.com/>here</a>.</p><p><img src=/images/2021-04-08-strava-activities-with-plotly/dash-app.png alt="Authenticated app"></p><h2 id=authentication>Authentication<a hidden class=anchor aria-hidden=true href=#authentication>#</a></h2><p>In dash applications all the necessary elements have to be rendered on startup.
I have a simple and straightforward layout, one div for authenticated and one for unauthenticated items.</p><p><img src=/images/2021-04-08-strava-activities-with-plotly/unauthenticated-app.png alt="Unauthenticated layout"></p><p>A single callback manages the login flow with the help of <a href=https://pythonhosted.org/stravalib/>stravalib</a>.</p><p>The auth flow was hugely inspired by <a href=https://github.com/AartGoossens/strava-dash-boilerplate>AartGoossens/strava-dash-boilerplate</a>.
The difference is that they switch rendered items, but I can not live with such dash warnings and errors during development.</p><h3 id=static-files-and-clientside-callbacks>Static files and Clientside callbacks<a hidden class=anchor aria-hidden=true href=#static-files-and-clientside-callbacks>#</a></h3><p>Dash looks for files <a href=https://dash.plotly.com/external-resources>automagically</a> from the assets folder.
In order to serve images I could simply reference them from this assets folder, but I wanted to see if I can have more control over it.</p><p>I added a simple clientside callback just for showcase, it could be done in python side.</p><h4 id=simple-way>Simple way<a hidden class=anchor aria-hidden=true href=#simple-way>#</a></h4><p>You can use <code>/assets/</code> prefix for your asset paths by default.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>app <span style=color:#f92672>=</span> dash<span style=color:#f92672>.</span>Dash(__name__)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app<span style=color:#f92672>.</span>layout <span style=color:#f92672>=</span> html<span style=color:#f92672>.</span>Div([
</span></span><span style=display:flex><span>    html<span style=color:#f92672>.</span>Img(src<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;/assets/image.png&#39;</span>)
</span></span><span style=display:flex><span>])
</span></span></code></pre></div><h4 id=flask-routes>Flask Routes<a hidden class=anchor aria-hidden=true href=#flask-routes>#</a></h4><p>You can use custom path with <code>@app.server.route</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> flask <span style=color:#f92672>import</span> send_from_directory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app <span style=color:#f92672>=</span> dash<span style=color:#f92672>.</span>Dash(__name__)
</span></span><span style=display:flex><span><span style=color:#a6e22e>@app</span><span style=color:#f92672>.</span>server<span style=color:#f92672>.</span>route(<span style=color:#e6db74>&#39;/static/&lt;path&gt;&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>serve_static</span>(path):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> send_from_directory(<span style=color:#e6db74>&#39;assets&#39;</span>, path)
</span></span></code></pre></div><h2 id=custom-component>Custom Component<a hidden class=anchor aria-hidden=true href=#custom-component>#</a></h2><p>I added the custom component to the same repository for simplicity. It could live on its own.</p><p>I like that I can develop components in React.</p><h3 id=demo-react-page>Demo React page<a hidden class=anchor aria-hidden=true href=#demo-react-page>#</a></h3><p>The demo page is tweakable and it can showcase different usecases, similar to storybook. It&rsquo;s a separate app.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;scripts&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;build:demo&#34;</span>: <span style=color:#e6db74>&#34;webpack --mode production --config ./webpack.serve.config.js&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I added a simple github actions script to deploy to github-pages. You can see it live <a href=https://budavariam.github.io/activity-visualizer/>here</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>deploy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>strategy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matrix</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>node-version</span>: [<span style=color:#ae81ff>14.</span><span style=color:#ae81ff>x]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v1</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Use Node.js ${{ matrix.node-version }}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/setup-node@v1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>node-version</span>: <span style=color:#ae81ff>${{ matrix.node-version }}</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Install Packages</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>cd ./activity_selector &amp;&amp; npm install</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build page</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>cd ./activity_selector &amp;&amp; npm run build:demo</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy to gh-pages</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-gh-pages@v3</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>publish_dir</span>: <span style=color:#ae81ff>./activity_selector/dist</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>github_token</span>: <span style=color:#ae81ff>${{ secrets.GITHUB_TOKEN }}</span>
</span></span></code></pre></div><h3 id=deploy-new-version>Deploy new version<a hidden class=anchor aria-hidden=true href=#deploy-new-version>#</a></h3><p>The base cookiecutter scripts do not provide good packaging script by default I usually roll my own solutions for it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;scripts&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;presdist&#34;</span>: <span style=color:#e6db74>&#34;npm run build&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sdist&#34;</span>: <span style=color:#e6db74>&#34;rm -r ./dist/; python setup.py sdist&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;postsdist&#34;</span>: <span style=color:#e6db74>&#34;(. venv/bin/activate || venv\\scripts\\activate &amp;&amp; bash ./script_postsdist.sh)&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sdist:version:activated&#34;</span>: <span style=color:#e6db74>&#34;(. venv/bin/activate || venv\\scripts\\activate &amp;&amp; npm version patch &amp;&amp; npm run sdist)&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;sdist:activated&#34;</span>: <span style=color:#e6db74>&#34;(. venv/bin/activate || venv\\scripts\\activate &amp;&amp; npm run sdist)&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>## script_postsdist.sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># assume that the virtual env has been activated and pwd is the project root directory</span>
</span></span><span style=display:flex><span>pushd ..
</span></span><span style=display:flex><span>rm ./activity_selector-*.tar.gz
</span></span><span style=display:flex><span>mv ./activity_selector/dist/activity_selector-* .
</span></span><span style=display:flex><span>NEW_FILE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>find . -name <span style=color:#e6db74>&#39;activity_selector*&#39;</span> -maxdepth <span style=color:#ae81ff>1</span> | head -1 | xargs basename<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>sed -i.bak <span style=color:#e6db74>&#34;s/activity_selector-\S*/</span>$NEW_FILE<span style=color:#e6db74>/&#34;</span> ./requirements.txt
</span></span><span style=display:flex><span>rm  ./*.bak
</span></span><span style=display:flex><span>pip install <span style=color:#e6db74>&#34;./</span>$NEW_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>popd <span style=color:#f92672>||</span> exit <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>With a simple <code>cd activity_selector && npm run sdist:version:activated</code> command (after dependency installs),
I can update the package in my app, it rewires the dependencies as well.</p><h2 id=dockerize-environment>Dockerize environment<a hidden class=anchor aria-hidden=true href=#dockerize-environment>#</a></h2><p>In order to see how it looks in the deploy environment in an easily reproducible way I decided to dockerize the app.</p><p>Multistage build keeps my image small, the base image and <code>requirements.txt</code> keeps my dependencies the same between installs.
Gunicorn provides a production grade server to deploy the app.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> python:3.6.13 as base</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> base as builder</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir /install<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /install</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> requirements.txt /requirements.txt<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./*.tar.gz .<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> pip install --no-cache-dir --prefix<span style=color:#f92672>=</span>/install --no-warn-script-location -r /requirements.txt<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> base</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> --from<span style=color:#f92672>=</span>builder /install /usr/local<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>WORKDIR</span><span style=color:#e6db74> /app</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir -p logs<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./src ./src<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./assets ./assets<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> ./logconfig.conf ./logconfig.conf<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 5000</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> gunicorn --bind 0.0.0.0:5000 --chdir ./src --log-config /app/logconfig.conf app:server<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=development-experience>Development experience<a hidden class=anchor aria-hidden=true href=#development-experience>#</a></h3><p>I debugged my code from VSCode. Kept my config variables in a <code>.env</code> file in the project root folder.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Use IntelliSense to learn about possible attributes.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// Hover to view descriptions of existing attributes.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#75715e>// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;0.2.0&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;configurations&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;Start Dev Server&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;python&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;request&#34;</span>: <span style=color:#e6db74>&#34;launch&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;program&#34;</span>: <span style=color:#e6db74>&#34;${workspaceRoot}/src/app.py&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;console&#34;</span>: <span style=color:#e6db74>&#34;integratedTerminal&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;env&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;DEBUG&#34;</span>: <span style=color:#e6db74>&#34;true&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;PYTHONPATH&#34;</span>: <span style=color:#e6db74>&#34;${workspaceRoot}/src&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;envFile&#34;</span>: <span style=color:#e6db74>&#34;${workspaceRoot}/.env&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;python&#34;</span>: <span style=color:#e6db74>&#34;${workspaceRoot}/src/venv/bin/python&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;justMyCode&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I used 3 separate terminals:</p><ul><li><code>cd activity_selector && npm start</code> to continously build the custom component.
See changes live at <a href=http://0.0.0.0:55554>http://0.0.0.0:55554</a>.</li><li>One console to run VSCode debugger at</li><li>One open console to update the component in the root app with: <code>pip install -e ./activity_selector</code></li></ul><p>I had much fun creating these configs for the project.</p><p>Happy Coding!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://budavariam.github.io/tags/dataviz/>dataviz</a></li><li><a href=https://budavariam.github.io/tags/plotly/>plotly</a></li><li><a href=https://budavariam.github.io/tags/dash/>dash</a></li><li><a href=https://budavariam.github.io/tags/strava/>strava</a></li><li><a href=https://budavariam.github.io/tags/docker/>docker</a></li><li><a href=https://budavariam.github.io/tags/github-actions/>github-actions</a></li></ul><div class=share-buttons><div class=addthis_inline_share_toolbox></div><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-602c2f70bcebfd93"></script></div></div></footer><script async data-uid=7d9354cde4 src=https://fabulous-experimenter-1073.ck.page/7d9354cde4/index.js></script><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//budavariam.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2022 <a href=https://budavariam.github.io/>Mátyás Budavári</a></span>
<span>&#183;</span>
<wbr><span>Powered&nbsp;by&nbsp;<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<wbr><span>Theme&nbsp;<a href=https://github.com/budavariam/hugo-PaperMod/tree/budavariam rel=noopener target=_blank>PaperMod&nbsp;(custom)</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<script defer src=/assets/js/copybtn.min.4ca2683e6d39c944ce34447501348e9b7c2805874fc5f1023f9534ecd3dd2b59.js integrity="sha256-TKJoPm05yUTONER1ATSOm3woBYdPxfECP5U07NPdK1k="></script>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById("menu").scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById("menu").scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
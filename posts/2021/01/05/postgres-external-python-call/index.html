<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Postgres External Python Call | Mátyás Budavári</title><meta name=keywords content="programming,database,postgres,sql,python,docker"><meta name=description content="After experiencing the awesomeness
of External Calls in Snowflake
I decided to look into the possibilities of running external snippets from Postgres."><meta name=author content="Mátyás Budavári"><meta name=theme-color content="#317EFB"><link rel=canonical href=https://budavariam.github.io/posts/2021/01/05/postgres-external-python-call/><meta name=google-site-verification content="ocrG4G5ZSn2awC0mgHAsgk2qlhd3IAXCACgWNrqJcwY"><link href=/assets/css/stylesheet.min.8992a6674f694d99a84bca35962c31e8f7c81352f54d3e95def071e7d30507dd.css integrity="sha256-iZKmZ09pTZmoS8o1liwx6PfIE1L1TT6V3vBx59MFB90=" rel="preload stylesheet" as=style><script src=https://kit.fontawesome.com/68da183384.js crossorigin=anonymous></script>
<link rel=icon href=https://budavariam.github.io/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://budavariam.github.io/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://budavariam.github.io/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://budavariam.github.io/favicon/apple-icon-180x180.png><link rel=mask-icon href=https://budavariam.github.io/favicon/apple-icon-180x180.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.98.0"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-115499513-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="Postgres External Python Call"><meta property="og:description" content="After experiencing the awesomeness
of External Calls in Snowflake
I decided to look into the possibilities of running external snippets from Postgres."><meta property="og:type" content="article"><meta property="og:url" content="https://budavariam.github.io/posts/2021/01/05/postgres-external-python-call/"><meta property="og:image" content="https://budavariam.github.io/logo.png"><meta property="article:published_time" content="2021-01-05T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-05T00:00:00+00:00"><meta property="og:site_name" content="Mátyás Budavári"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://budavariam.github.io/logo.png"><meta name=twitter:title content="Postgres External Python Call"><meta name=twitter:description content="After experiencing the awesomeness
of External Calls in Snowflake
I decided to look into the possibilities of running external snippets from Postgres."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://budavariam.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Postgres External Python Call","item":"https://budavariam.github.io/posts/2021/01/05/postgres-external-python-call/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Postgres External Python Call","name":"Postgres External Python Call","description":"After experiencing the awesomeness of External Calls in Snowflake I decided to look into the possibilities of running external snippets from Postgres.\n","keywords":["programming","database","postgres","sql","python","docker"],"articleBody":"After experiencing the awesomeness of External Calls in Snowflake I decided to look into the possibilities of running external snippets from Postgres.\nI did not need to search too much to find out that it supports external calls to other languages beside SQL and C, called Procedural Languages.\nOut of the documented languages I choose Python to experiment with.\nCreate a docker image with Python and the extension You must install python3 and plpython3 explicitly. The rest is not mandatory, it would be inherited from the original image.\nFROMpostgres:12RUN apt-get updateRUN apt-get -y install python3 python3-pip postgresql-plpython3-12RUN apt-get clean \u0026\u0026 \\  rm -rf /var/cache/apt/* /var/lib/apt/lists/*ENTRYPOINT [\"/docker-entrypoint.sh\"]EXPOSE5432CMD [\"postgres\"]Note about python3 version The postgres image is based on a slim debian image. In case you need a specfic version combination, or a shiny new python version you might have a hard time.\nIf the docker postgres image starts from a debian version that do not officially support the necessary python version, you need to figure out a suitable way to get it done.\nOne way is to build python from its source code, and to make sure that it is really used by plpython3u.\nAnother way would be to start from an os image (like a newer debian) and install postgres and python as well. And make sure that your code does all the things that the base postgres image would do, to achieve better compatibility.\nSome of the current latest version combnations:\n postgres:11 (stretch) installs python3.5.3 postfres:12 (buster) installs python3.7.3 postgres:13 (buster) installs python3.7.3  Create a stored procedure in Python Before you can start to work on your python code you need to enable the python language extension by running the following code once.\n-- need to call it once CREATE EXTENSION plpython3u; If the environment is ready you can create your python code wrapped in a stored procedure. Official docs.\n-- DROP FUNCTION hello_world; -- define incoming parameters with type CREATE FUNCTION hello_world (how text)  RETURNS table (  -- return row definition  index integer,  greeting text  ) AS $$  -- add any python code here  for index, who in enumerate([ \"World\", \"PostgreSQL\", \"PL/Python\" ]):  yield ( index, f\"{how} {who}!\" )  -- end of python code $$ LANGUAGE plpython3u; Use custom python libraries You can import python libraries in your code as well. In case you use it in an orchestrated environment e.g: kubernetes, you’ll need to make sure that the install directory is persisted.\nYou can install them manually inside the docker image (docker exec), or ship the docker image with the libs preinstalled (RUN pip3 install mylib). It depends on your constraints of what might be a better option.\nManual install The database does not need to be stopped, though the defined function won’t be available while you switch the two lib versions.\nIt might be the better choice while you need quick iterations, or you just like to get your hands dirty or you develop a custom lib just to use its code from postgres.\nShipped install You need to specify the lib version in the docker image, run pip install -r requirements.txt and ship a new version.\nIt might be the better choice if your database don’t have internet access, or you need to specifically keep track of the different version combinations.\nCall the stored procedure You can call the stored procedure in the from clause.\nselect * from hello_world('Hello'); -- index | greeting -- -------+------------------- -- 0 | Hello World! -- 1 | Hello PostgreSQL! -- 2 | Hello PL/Python!  select greeting from hello_world('Goodbye'); -- greeting -- --------------------- -- Goodbye World! -- Goodbye PostgreSQL! -- Goodbye PL/Python! Access the database In case you need to get/set data in database you can connect to it from python code with the plpy module.\nCREATE FUNCTION try_adding_joe() RETURNS text AS $$  try:  plpy.execute(\"INSERT INTO users(username) VALUES ('joe')\")  except plpy.SPIError:  return \"something went wrong\"  else:  return \"Joe added\" $$ LANGUAGE plpython3u; For more info see the official docs.\nBeware, it’s untrusted Before you rush to use it in your production app, I advise you, to evaluate the security risks it can add to your database.\nYou might’ve noticed the u at the end of plpython3u. Its meaning is defined in the official docs:\n PL/Python is only available as an “untrusted” language, meaning it does not offer any way of restricting what users can do in it and is therefore named plpythonu. … The writer of a function in untrusted PL/Python must take care that the function cannot be used to do anything unwanted, since it will be able to do anything that could be done by a user logged in as the database administrator. Only superusers can create functions in untrusted languages such as plpythonu.\n Happy Coding!\n","wordCount":"787","inLanguage":"en","datePublished":"2021-01-05T00:00:00Z","dateModified":"2021-01-05T00:00:00Z","author":{"@type":"Person","name":"Mátyás Budavári"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://budavariam.github.io/posts/2021/01/05/postgres-external-python-call/"},"publisher":{"@type":"Organization","name":"Mátyás Budavári","logo":{"@type":"ImageObject","url":"https://budavariam.github.io/favicon/favicon.ico"}}}</script><script src=https://cdn.lr-ingest.io/LogRocket.min.js crossorigin=anonymous></script>
<script>window.LogRocket&&window.LogRocket.init("0igxfm/budavariam-blog"),window.LogRocket.getSessionURL(function(e){ga("send",{hitType:"event",eventCategory:"LogRocket",eventAction:e})})</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://budavariam.github.io/ title="Mátyás Budavári (Alt + H)" class=site-avatar><img src=/avatar.png alt=logo aria-label=logo height=70 width=70></a><div class=site-info><h1 class=site-name><a href=https://budavariam.github.io/ accesskey=h title="Mátyás Budavári (Alt + H)">Mátyás Budavári</a></h1><p class=site-description>Developer from Szeged</p></div></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://budavariam.github.io/about/ title=About><span>About</span></a></li><li><a href=https://budavariam.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://budavariam.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://budavariam.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://budavariam.github.io/projects/ title=Projects><span>Projects</span></a></li><li><span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Postgres External Python Call</h1><div class=post-meta>January 5, 2021&nbsp;·&nbsp;4 min&nbsp;·&nbsp;Mátyás Budavári
|&nbsp;<a class=edit-post href=https://github.com/budavariam/budavariam.github.io/blob/main/content/posts/2021-01-05-postgres-external-python-call.md rel="noopener noreferrer" target=_blank>Make it better</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#create-a-docker-image-with-python-and-the-extension aria-label="Create a docker image with Python and the extension">Create a docker image with Python and the extension</a><ul><li><a href=#note-about-python3-version aria-label="Note about python3 version">Note about python3 version</a></li></ul></li><li><a href=#create-a-stored-procedure-in-python aria-label="Create a stored procedure in Python">Create a stored procedure in Python</a><ul><li><a href=#use-custom-python-libraries aria-label="Use custom python libraries">Use custom python libraries</a><ul><li><a href=#manual-install aria-label="Manual install">Manual install</a></li><li><a href=#shipped-install aria-label="Shipped install">Shipped install</a></li></ul></li></ul></li><li><a href=#call-the-stored-procedure aria-label="Call the stored procedure">Call the stored procedure</a></li><li><a href=#access-the-database aria-label="Access the database">Access the database</a></li><li><a href=#beware-its-untrusted aria-label="Beware, it&amp;rsquo;s untrusted">Beware, it&rsquo;s untrusted</a></li></ul></div></details></div><div class=post-content><p>After <a href=/posts/2020/12/30/external-function-from-snowflake/>experiencing the awesomeness</a>
of External Calls in Snowflake
I decided to look into the possibilities of running external snippets from Postgres.</p><p>I did not need to search too much to find out that it supports external calls to other languages
beside SQL and C, called <a href=https://www.postgresql.org/docs/13/xplang.html>Procedural Languages</a>.</p><p>Out of the documented languages I choose
<a href=https://www.postgresql.org/docs/13/plpython-python23.html>Python</a> to experiment with.</p><h2 id=create-a-docker-image-with-python-and-the-extension>Create a docker image with Python and the extension<a hidden class=anchor aria-hidden=true href=#create-a-docker-image-with-python-and-the-extension>#</a></h2><p>You must install <code>python3</code> and <code>plpython3</code> explicitly.
The rest is not mandatory, it would be inherited from the original image.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> postgres:12</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get update<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> apt-get -y install python3 python3-pip postgresql-plpython3-12<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span>  apt-get clean <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>     rm -rf /var/cache/apt/* /var/lib/apt/lists/*<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span> [<span style=color:#e6db74>&#34;/docker-entrypoint.sh&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 5432</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;postgres&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=note-about-python3-version>Note about python3 version<a hidden class=anchor aria-hidden=true href=#note-about-python3-version>#</a></h3><p>The postgres image is based on a slim debian image.
In case you need a specfic version combination,
or a shiny new python version you might have a hard time.</p><p>If the docker postgres image starts from a debian version that do not officially support
the necessary python version, you need to figure out a suitable way to get it done.</p><p>One way is to build python from its source code, and to make sure that it is really used by plpython3u.</p><p>Another way would be to start from an os image (like a newer debian) and install postgres and python as well.
And make sure that your code does all the things that the base postgres image would do, to achieve better compatibility.</p><p>Some of the current latest version combnations:</p><ul><li>postgres:11 (stretch) installs python3.5.3</li><li>postfres:12 (buster) installs python3.7.3</li><li>postgres:13 (buster) installs python3.7.3</li></ul><h2 id=create-a-stored-procedure-in-python>Create a stored procedure in Python<a hidden class=anchor aria-hidden=true href=#create-a-stored-procedure-in-python>#</a></h2><p>Before you can start to work on your python code you need to enable
the python language extension by running the following code once.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- need to call it once
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> EXTENSION plpython3u;
</span></span></code></pre></div><p>If the environment is ready you can create your python code wrapped in a stored procedure.
<a href=https://www.postgresql.org/docs/13/plpython-funcs.html>Official docs</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#75715e>-- DROP FUNCTION hello_world;
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- define incoming parameters with type
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>FUNCTION</span> hello_world (how text)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>RETURNS</span> <span style=color:#66d9ef>table</span> (
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- return row definition
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>index</span>      integer,
</span></span><span style=display:flex><span>    greeting   text
</span></span><span style=display:flex><span>  )
</span></span><span style=display:flex><span><span style=color:#66d9ef>AS</span> <span style=color:#960050;background-color:#1e0010>$$</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>-- add any python code here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>for</span> <span style=color:#66d9ef>index</span>, who <span style=color:#66d9ef>in</span> enumerate([ <span style=color:#e6db74>&#34;World&#34;</span>, <span style=color:#e6db74>&#34;PostgreSQL&#34;</span>, <span style=color:#e6db74>&#34;PL/Python&#34;</span> ]):
</span></span><span style=display:flex><span>    yield ( <span style=color:#66d9ef>index</span>, f<span style=color:#e6db74>&#34;{how} {who}!&#34;</span> )
</span></span><span style=display:flex><span>  <span style=color:#75715e>-- end of python code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#960050;background-color:#1e0010>$$</span> <span style=color:#66d9ef>LANGUAGE</span> plpython3u;
</span></span></code></pre></div><h3 id=use-custom-python-libraries>Use custom python libraries<a hidden class=anchor aria-hidden=true href=#use-custom-python-libraries>#</a></h3><p>You can import python libraries in your code as well.
In case you use it in an orchestrated environment e.g: <a href=https://kubernetes.io/>kubernetes</a>,
you&rsquo;ll need to make sure that the install directory is persisted.</p><p>You can install them manually inside the docker image (<code>docker exec</code>),
or ship the docker image with the libs preinstalled (<code>RUN pip3 install mylib</code>).
It depends on your constraints of what might be a better option.</p><h4 id=manual-install>Manual install<a hidden class=anchor aria-hidden=true href=#manual-install>#</a></h4><p>The database does not need to be stopped, though the defined function
won&rsquo;t be available while you switch the two lib versions.</p><p>It might be the better choice while you need quick iterations,
or you just like to get your hands dirty or you develop a custom lib just to use its code from postgres.</p><h4 id=shipped-install>Shipped install<a hidden class=anchor aria-hidden=true href=#shipped-install>#</a></h4><p>You need to specify the lib version in the docker image, run <code>pip install -r requirements.txt</code>
and ship a new version.</p><p>It might be the better choice if your database don&rsquo;t have internet access,
or you need to specifically keep track of the different version combinations.</p><h2 id=call-the-stored-procedure>Call the stored procedure<a hidden class=anchor aria-hidden=true href=#call-the-stored-procedure>#</a></h2><p>You can call the stored procedure in the from clause.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>from</span> hello_world(<span style=color:#e6db74>&#39;Hello&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>--  index |     greeting
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- -------+-------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>--      0 | Hello World!
</span></span></span><span style=display:flex><span><span style=color:#75715e>--      1 | Hello PostgreSQL!
</span></span></span><span style=display:flex><span><span style=color:#75715e>--      2 | Hello PL/Python!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> greeting <span style=color:#66d9ef>from</span> hello_world(<span style=color:#e6db74>&#39;Goodbye&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>--       greeting
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- ---------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>--  Goodbye World!
</span></span></span><span style=display:flex><span><span style=color:#75715e>--  Goodbye PostgreSQL!
</span></span></span><span style=display:flex><span><span style=color:#75715e>--  Goodbye PL/Python!
</span></span></span></code></pre></div><h2 id=access-the-database>Access the database<a hidden class=anchor aria-hidden=true href=#access-the-database>#</a></h2><p>In case you need to get/set data in database you can connect to it from python code with the <code>plpy</code> module.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>FUNCTION</span> try_adding_joe() <span style=color:#66d9ef>RETURNS</span> text <span style=color:#66d9ef>AS</span> <span style=color:#960050;background-color:#1e0010>$$</span>
</span></span><span style=display:flex><span>    try:
</span></span><span style=display:flex><span>        plpy.<span style=color:#66d9ef>execute</span>(<span style=color:#e6db74>&#34;INSERT INTO users(username) VALUES (&#39;joe&#39;)&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> plpy.SPIError:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;something went wrong&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Joe added&#34;</span>
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>$$</span> <span style=color:#66d9ef>LANGUAGE</span> plpython3u;
</span></span></code></pre></div><p>For more info see the <a href=https://www.postgresql.org/docs/13/plpython-database.html>official docs</a>.</p><h2 id=beware-its-untrusted>Beware, it&rsquo;s untrusted<a hidden class=anchor aria-hidden=true href=#beware-its-untrusted>#</a></h2><p>Before you rush to use it in your production app, I advise you, to evaluate the security risks it can add to your database.</p><p>You might&rsquo;ve noticed the <code>u</code> at the end of <code>plpython3u</code>. Its meaning is defined in the <a href=https://www.postgresql.org/docs/12/plpython.html#docComments>official docs</a>:</p><blockquote><p>PL/Python is only available as an &ldquo;untrusted&rdquo; language, meaning it does not offer any way of restricting what users can do in it and is therefore named plpythonu.
&mldr;
The writer of a function in untrusted PL/Python must take care that the function cannot be used to do anything unwanted,
since it will be able to do anything that could be done by a user logged in as the database administrator.
Only superusers can create functions in untrusted languages such as plpythonu.</p></blockquote><p>Happy Coding!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://budavariam.github.io/tags/programming/>programming</a></li><li><a href=https://budavariam.github.io/tags/database/>database</a></li><li><a href=https://budavariam.github.io/tags/postgres/>postgres</a></li><li><a href=https://budavariam.github.io/tags/sql/>sql</a></li><li><a href=https://budavariam.github.io/tags/python/>python</a></li><li><a href=https://budavariam.github.io/tags/docker/>docker</a></li></ul><div class=share-buttons><div class=addthis_inline_share_toolbox></div><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-602c2f70bcebfd93"></script></div></div></footer><script async data-uid=7d9354cde4 src=https://fabulous-experimenter-1073.ck.page/7d9354cde4/index.js></script><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//budavariam.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2022 <a href=https://budavariam.github.io/>Mátyás Budavári</a></span>
<span>&#183;</span>
<wbr><span>Powered&nbsp;by&nbsp;<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<wbr><span>Theme&nbsp;<a href=https://github.com/budavariam/hugo-PaperMod/tree/budavariam rel=noopener target=_blank>PaperMod&nbsp;(custom)</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<script defer src=/assets/js/copybtn.min.4ca2683e6d39c944ce34447501348e9b7c2805874fc5f1023f9534ecd3dd2b59.js integrity="sha256-TKJoPm05yUTONER1ATSOm3woBYdPxfECP5U07NPdK1k="></script>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById("menu").scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById("menu").scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>